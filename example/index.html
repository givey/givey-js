<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Givey JavaScript SDK</title>
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <link rel="stylesheet" href="css/bootstrap-theme.css"/>
    <link rel="stylesheet" href="css/app.css"/>
  </head>
  <body>

    <div class="container">

      <div class="row">

        <div class="col-lg-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h1 class="business-name">loading..</h1>
            </div>
            <div class="panel-body">
              <p class="business-profile"></p>
              <br/>
              <table class="table table-striped business-metrics">
              </table>
            </div>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h2>Employees</h2>
            </div>
            <div class="panel-body tabular-data">
              <table class="table table-striped table-hover business-employees">
              </table>
            </div>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h2>Donations</h2>
            </div>
            <div class="panel-body">
              <div class="alert alert-info">Coming soon!</div>
            </div>
          </div>
        </div>

      </div>
    </div>


    <script src="../dist/givey.js"></script>
    <script>
      var Givey = new GiveyApp();
      Givey.find('business', 'giveybiz').then(function (business) {
        $('.business-name').html(''
          + '<a href="https://www.givey.com/' + business.get('giveyTag') + '">'
            + business.get('name')
          + '</a>'
        );
        $('.business-profile').html(business.get('profileMessage'));
        var metrics = {
          matchCount: 'Number of Matches',
          matchTotalFormatted: 'Matched Amount'
        }
        $('.business-metrics').empty();
        $.each(metrics, function(attr, name) {
          var tr = $('<tr>');
          tr.html(''
            + '<td>' + name + '</td>'
            + '<td class="text-right">' + business.get(attr) + '</td>'
          )
          $('.business-metrics').append(tr);
        });
        business.get('employees').then(function (employees) {
          $.each(employees, function (_, user) {
            var link = 'https://www.givey.com/' + user.get('giveyTag');
            var tr = $('<tr>');
            tr.html(''
              + '<td width="10%">'
                + '<img src="' + user.get('avatarUrl') + '" width="48" height="48" alt=""/>'
              + '</td>'
              + '<td>'
                + '<h3><a href="' + link + '" target="_blank">' + (user.get('fullName') || user.get('shortName')) + '</a></h3>'
                + '<span class="text-muted">givey.com/' + user.get('giveyTag') + '</span>'
              + '</td>'
            );
            $('.business-employees').append(tr);
          });
        });
      });
    </script>

  </body>
</html>
