/*! givey 21-03-2014 */
GiveyAppAdapters.Backbone={App:{}},GiveyAppAdapters.Backbone.App.Base=Backbone.Model.extend({getCloudinaryId:function(a){if(a.indexOf("image/upload")>-1){var b=a.match(/image\/upload((\/[a-z0-9,_]+)?\/(v[0-9]+))?\/([a-z0-9]+)\.(gif|jpg|png)/i);if(b&&b[4])return b[4]}return!1}}),GiveyAppAdapters.Backbone.App.Business=GiveyAppAdapters.Backbone.App.Base.extend({url:function(){return[App.Defaults.host,"/businesses/",App.Defaults.businessId].join("")},parse:function(a){var b=parseInt(a.match_total_cache)+1140775,c=Math.round(b/100).toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,");return{id:a.id,givey_tag:a.givey_tag,amount_raised:b,amount_raised_gbp:c,match_count:a.match_count_cache,employee_count:a.employee_count}}}),GiveyAppAdapters.Backbone.App.Channel=GiveyAppAdapters.Backbone.App.Base.extend({parse:function(a){var b=a.hero_image_url;(!b||b.isGiveyDefaultImage())&&(b=App.Defaults.LMGChannelImage);var c=this.getCloudinaryId(b);c&&(b="http://res.cloudinary.com/givey/image/upload/w_600,h_600,c_fill,g_faces/"+c+".png");var d={id:a.id,givey_tag:a.givey_tag,title:[a.name,"for",a.charity.name].join(" "),image:b,user_name:a.user.short_name};return d}}),GiveyAppAdapters.Backbone.App.Charity=GiveyAppAdapters.Backbone.App.Base.extend({parse:function(a){var b=a.avatar_url;(!b||b.isGiveyDefaultImage())&&(b=App.Defaults.LMGCharityImage);var c=this.getCloudinaryId(b);c&&(b="http://res.cloudinary.com/givey/image/upload/w_200,h_200,c_fill,g_faces/"+c+".png");var d={id:a.id,name:a.name,givey_tag:a.givey_tag,url:App.Defaults.giveyPublicURL+"/"+a.givey_tag.toLowerCase(),image_url:b,amount_raised:250};return d}}),GiveyAppAdapters.Backbone.App.Donation=GiveyAppAdapters.Backbone.App.Base.extend({parse:function(a){var b=_.map(a.donation_images_textile,function(a){var b=/!\((.+)\)(.+)!:(.+)/,c=b.exec(a),d=c[1],e=c[2],f=c[3],g='<p><a href="{{url}}"><img class="{{classes}}" src="{{imageUrl}}" alt="" /></a></p>',h=g.replace("{{url}}",f),h=h.replace("{{classes}}",d),h=h.replace("{{imageUrl}}",e);return h}),c=_.find(b,function(a){return $(a).find("img.user").length>0}),d=_.find(b,function(a){return $(a).find("img.via").length>0});c=$(c).find("img").attr("src"),d=$(d).find("img").attr("src"),(!c||c.isGiveyDefaultImage())&&(c=App.Defaults.LMGUserImage),(!d||d.isGiveyDefaultImage())&&(d=App.Defaults.LMGUserImage);var e;e=this.getCloudinaryId(c),e&&(c="http://res.cloudinary.com/givey/image/upload/w_250,h_250,c_fill,g_faces/"+e+".png"),e=this.getCloudinaryId(d),e&&(d="http://res.cloudinary.com/givey/image/upload/w_65,h_65,c_fill,g_faces/"+e+".png");var f=/\[(.+?)\]/g;matches=a.donation_string_textile.match(f);var g=a.donation_string_textile;_.each(matches,function(a){var b='<a class="{{classes}}" href="{{url}}">{{name}}</a>',c=/\[\"\((.+)\)\.(.+)\":(.+)\]/,d=c.exec(a),e=d[1],f=d[2],h=d[3],i=b.replace("{{classes}}",e),i=i.replace("{{name}}",f),i=i.replace("{{url}}",h);g=g.replace(a,i)}),donation_string="<p>"+g+"</p>";var h={id:a.id,url:a.canonical_url,user_image:c,giver_target_image:d,donation_string:donation_string};return h}}),GiveyAppAdapters.Backbone.App.Story=GiveyAppAdapters.Backbone.App.Base.extend({parse:function(a){var b={title:a.header,summary:a.summary,url:a.url,image:a.image_thumbnail_medium};return b}});